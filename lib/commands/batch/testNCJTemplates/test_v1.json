{
  "parameters": {
    "accountName": {
      "type": "string",
      "metadata": {
        "description": "name of batch account"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('accountName')]",
      "type": "Microsoft.Batch/batchAccounts",
      "location": "westus",
      "resources": [
        {
          "type": "NCJs",
          "name": "testncj",
          "resources": [
            {
              "type": "NCJSoftwares",
              "name": "matlab",
              "properties":{
                "applicationPackage": "[reference(concat('Microsoft.Batch/batchAccounts/', parameters('accountName'), '/applications/matlab/versions/1.0'))]",
                "installCmd": "msiexec /si matlab.msi",
                "reboot": false
              }
            },
            {
              "type": "NCJSoftwares",
              "name": "dotnet35",
              "properties":{
                "installCmd": "DISM /Online /Enable-Feature /FeatureName:NetFx3 /All /LimitAccess /Source:d:\\sources\\sxs",
                "reboot": true
              }
            },
            {
              "type": "NCJPaaSPools",
              "name": "testpool",
              "properties":{
                "osFamily": "4",
                "version": "*",
                "size": "Small",
                "count": 1,
                "softwares": [
                  "[reference(concat('Microsoft.Batch/batchAccounts/', parameters('accountName'), '/NCJSoftwares/matlab'))]"
                ]
              }
            },
            {
              "type": "NCJJobs",
              "name": "job_v1",
              "properties": {
                "maxWallClockTime": "PT5H",
                "pool": "[reference('NCJPaaSPools/testpool')]",
                "softwares": [
                  "[reference('NCJSoftwares/dotnet35')]"
                ],
                "taskfactory": {
                  "type": "parametricsweepTask",
                  "properties": {
                    "start": 1,
                   "end": 100,
                    "skip": 1,
                    "cmdLine": "echo helloworld from {$}",
                    "resourceFiles": [
                      {
                        "path": "helloworld{$}.txt",
                        "source": "some-sas-uri-of-helloword{$}.txt" 
                      }
                    ]
                  }
                }
              } 
            }
          ] 
        }
      ]
    }
  ]
}
