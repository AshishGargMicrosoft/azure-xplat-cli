{
    "templateMetadata" : {
        "description" : "Sample application template for data movement."
    },
    "parameters": {
        "taskStart": {
            "type": "int",
            "metadata": {
                "description": "The sweep start parameter"
            }
        },
        "taskEnd": {
            "type": "int",
            "metadata": {
                "description": "The sweep end parameter"
            }
        },
        "testData": {
            "type": "string",
            "metadata": {
                "description": "The auto-storage group where the input data is stored."
            }
        },
        "outputFileStorageUrl": {
            "type": "string",
            "metadata": {
                "description": "A storage SAS URL to a blob container with write access."
            }
        },
        "filename" : {
            "type": "string",
            "default": "input{0}.txt",
            "metadata": {
                "description": "A file specification containing a {0} for the parametric sweep index number."
            }
        }
    },
    "onAllTasksComplete": "terminateJob",
    "taskFactory": {
        "type": "parametricSweep",
        "parameterSets": [
            {
                "start": "[parameters('taskStart')]",
                "end": "[parameters('taskEnd')]",
                "step": 1
            }
        ],
        "repeatTask": {
            "commandLine": "/bin/bash -c 'cat [parameters('filename')]'",
            "resourceFiles": [
                {
                    "source": { 
                        "fileGroup": "[parameters('testData')]",
                        "prefix": "[parameters('filename')]"
                    }
                }
            ],
            "outputFiles": [
                {
                    "filePattern": "$AZ_BATCH_TASK_DIR/stdout.txt",
                    "destination": {
                        "container": {
                            "path": "output{0}.txt",
                            "containerSas": "[parameters('outputFileStorageUrl')]"
                        }
                    },
                    "uploadDetails": {
                        "taskStatus": "TaskSuccess"
                    }
                }
            ]
        }
    }
}